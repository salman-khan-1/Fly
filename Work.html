<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    
    <title>karwan</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/5.0/examples/dashboard/">

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="dashboard.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    
    <!-- PDF.js library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.95);
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        body {
            background: linear-gradient(135deg, #f0f4f8 0%, #e2e8f0 100%);
            min-height: 100vh;
            padding: 0;
            margin: 0;
            overflow-x: hidden;
            font-family: 'Segoe UI', system-ui, sans-serif;
        }
        
        .container-fluid {
            padding: 0.5rem;
            max-width: 100%;
        }
        
        .main-container {
            max-height: 50vh;
            overflow-y: auto;
        }
        
        .card-glass {
            background: var(--glass-bg);
            border: 1px solid rgba(0,0,0,0.05);
            border-radius: 0.75rem;
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(2px);
        }
        
        .form-control-sm, .btn-sm {
            font-size: 0.8125rem;
            padding: 0.25rem 0.5rem;
        }
        
        .input-group-text {
            background: rgba(255, 255, 255, 0.7);
            padding: 0.25rem 0.5rem;
        }
        
        .risk-bar {
            height: 4px;
            border-radius: 2px;
            margin-top: 4px;
        }
        .risk-low { background-color: #28a745; width: 100%; }     /* Green */
        .risk-medium { background-color: #ffc107; width: 50%; }  /* Yellow */
        .risk-high { background-color: #dc3545; width: 100%; }    /* Red */
        
        .sticky-bar {
            position: sticky;
            bottom: 0;
            background: var(--glass-bg);
            border-top: 1px solid rgba(0,0,0,0.05);
            backdrop-filter: blur(4px);
            z-index: 1000;
            padding: 0.5rem 0;
        }
        .nav-tabs{
            background-color: #0b5ed747;
        }
        .nav-tabs .nav-link {
            border: none;
            border-bottom: 3px solid transparent;
            color: #495057;
            font-weight: 500;
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .nav-tabs .nav-link.active {
            border-bottom: 3px solid #1565c0;
            color: #0d6efd;
            background: #9dc1f0;
        }
        
        .editable-cell {
            padding: 0.15rem !important;
        }
        
        .editable-cell input {
            border: 1px solid #dee2e6;
            background: white;
            width: 100%;
            padding: 0.15rem 0.3rem;
            border-radius: 0.2rem;
            font-size: 0.8125rem;
        }
        
        .editable-cell input:focus {
            background: rgba(13, 110, 253, 0.1);
            outline: none;
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.15);
        }
        
        .table-scroll {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .table thead th {
            position: sticky;
            top: 0;
            z-index: 10;
            font-size: 0.8125rem;
            padding: 0.3rem 0.5rem;
        }
        
        .currency-alert, .po-alert {
            display: none;
            padding: 0.2rem 0.4rem;
            font-size: 0.75rem;
            margin-top: 0.2rem;
            border-radius: 0.2rem;
        }
        
        .tooltip-panel {
            display: none;
            position: absolute;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 0.4rem;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
            padding: 0.75rem;
            width: 260px;
            z-index: 1000;
            font-size: 0.8125rem;
        }
        
        .invoice-header {
            background: linear-gradient(to right, #0d6efd, #0b5ed7);
            color: white;
            border-radius: 0.5rem 0.5rem 0 0;
            padding: 0.5rem 1rem;
        }
        
        .card-divider {
            height: 1px;
            background: rgba(0,0,0,0.08);
            margin: 0.4rem 0;
        }
        
        .table-controls {
            background: #f8f9fa;
            padding: 0.4rem 0.8rem;
            border-top: 1px solid #dee2e6;
        }
        
        .row-highlight {
            background-color: rgba(13, 110, 253, 0.05) !important;
        }
        
        .compact-form-label {
            font-size: 0.75rem;
            margin-bottom: 0.2rem;
            font-weight: 600;
            color: #495057;
        }
        
        .table > :not(:first-child) {
            border-top: none;
        }
        
        .table td, .table th {
            vertical-align: middle;
            padding: 0.3rem 0.5rem;
            font-size: 0.8125rem;
        }
        
        .btn-xs {
            padding: 0.15rem 0.4rem;
            font-size: 0.75rem;
            border-radius: 0.25rem;
        }
        
        .badge-sm {
            font-size: 0.65rem;
            padding: 0.15rem 0.3rem;
        }

        /* File Attachment Styles */
        .attachment-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 0.75rem;
            padding: 2.5rem;
            text-align: center;
            margin-bottom: 1.5rem;
            background-color: #f8f9fa;
            cursor: pointer;
            transition: 0.3s;
        }
        
        .attachment-upload-area.dragover {
            border-color: #0d6efd;
            background-color: #e3f2fd;
        }
        
        .attachment-item {
            border: 1px solid #dee2e6;
            border-radius: 0.75rem;
            padding: 1.25rem;
            margin-bottom: 1rem;
            background: #fff;
        }
        
        .attachment-icon {
            font-size: 2rem;
            margin-right: 1rem;
        }
        
        .pdf-canvas-container {
            height: 70vh;
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        canvas.pdf-page {
            border: 1px solid #dee2e6;
            margin-bottom: 10px;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Hidden print iframe */
        #print-frame {
            position: absolute;
            width: 0;
            height: 0;
            border: none;
            visibility: hidden;
        }
        
        .loading-toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Print Section Styles - Hidden by default */
        #printSection {
            display: none;
        }

        /* New Attachment UI Styles */
        .upload-field-row {
            transition: all 0.2s ease-in-out;
        }
        .upload-field-row:hover {
            background-color: rgba(13, 110, 253, 0.05);
            transform: scale(1.01);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
        }
        .custom-name::placeholder {
            color: #6c757d;
            font-style: italic;
        }
        #addFieldBtn {
            transition: 0.2s;
        }
        #addFieldBtn:hover {
            background-color: #198754cc;
            transform: translateY(-1px);
        }

        /* Checkbox selection styles */
        .row-selected {
            background-color: rgba(13, 110, 253, 0.1) !important;
        }

@media print {
    @page {
        size: A4;
        margin: 5mm;
    }
    
    /* Hide normal content */
    .notprintable, header, nav, .sticky-bar, .print-controls {
        display: none !important;
    }
    
    /* Remove debug borders */
    /* * {
        border: 1px solid red !important;
    } */
    
    /* Show print section */
    #printSection {
        display: block !important;
    }
    
    /* Print section specific styles */
    :root {
        --primary-color: #2c3e50;
        --secondary-color: #e0e0e0;
        --border-color: #000000;
        --text-color: #000;
    }

    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        
        padding: 0 !important;
        color: var(--text-color);
        margin: 0;
        line-height: 1.4;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        font-size: 10pt;
        line-height: 1.2;
        height: auto !important;
        min-height: 100% !important;
        overflow: visible !important;
        background: #ffffff !important;
    }

    .print-container {
        max-width: 100%;
        margin: 0; /* REMOVED margin-top: 20mm */
        padding: 0;
        background: #fff;
    }

    .header-title {
        background-color: #cfcfcf!important;
        color: #000 !important;
        font-size: 12pt !important;
        padding: 6px 0 !important;
        border-radius: 8px 8px 0 0;
        border: 0.9px solid #000 !important;
        font-weight: 700;
        text-align: center;
        margin: 0;
    }

    .meta-bar {
        background-color: #e0e0e0 !important;
        color: #000 !important;
        font-size: 8pt !important;
        padding: 4px 8px !important;
        border: 0.9px solid #000 !important;
        display: flex;
        flex-wrap: wrap;
        margin-bottom: 5px !important; /* REDUCED from 10px */
        gap: 5px;
    }

    .meta-bar > .left {
        flex: 1;
        text-align: start;
    }

    .meta-bar > .right {
        flex: 1;
        text-align: end;
    }

    .meta-bar > .full {
        flex: 0 0 100%;
        text-align: start;
    }

    /* FIXED: Allow card to break if needed */
    .card-invoice {
        border: 0.9px solid #000 !important;
        background-color: transparent !important;
        padding: 10px !important; /* REDUCED padding */
        margin-bottom: 5px !important; /* REDUCED margin */
        border-radius: 6px !important;
        page-break-inside: auto; /* CHANGED from avoid */
        break-inside: auto; /* CHANGED from avoid */
    }

    .invoice-meta {
        font-size: 8.5pt !important;
        font-weight: 550 !important;
    }

    .invoice-meta .row {
        display: flex !important;
        flex-wrap: wrap !important;
        margin-bottom: 6px !important; /* REDUCED */
        page-break-inside: avoid;
        break-inside: avoid;
    }

    .invoice-meta .row > div {
        flex: 0 0 auto !important;
        width: 50% !important;
        padding: 3px 6px !important; /* REDUCED */
        box-sizing: border-box !important;
    }

    .invoice-meta .row > .bigcol {
        width: 60% !important;
    }
    
    .invoice-meta .row > .smlcol {
        width: 40% !important;
    }

    .invoice-meta .label {
        font-size: 8.5pt !important;
        font-weight: 550 !important;
        color: black !important;
        display: inline-block !important;
        background-color: transparent;
        min-width: 110px !important; /* REDUCED */
    }

    .invoice-meta .value {
        background-color: #cfcfcf !important;
        padding: 1px 4px; /* REDUCED */
        border-radius: 2px;
        font-size: 8.5pt !important;
        font-weight: 550 !important;
    }

    /* FIXED: Allow table to break naturally */
    .table-container {
        overflow-x: auto;
        margin-bottom: 15px;
        page-break-inside: auto; /* CHANGED from avoid */
    }

    table {
        font-size: 0.9rem;
        border-collapse: collapse !important;
        width: 100% !important;
        page-break-inside: auto;
    }

    thead {
        display: table-header-group;
    }

    tbody {
        page-break-inside: auto;
    }

    thead th {
        background-color: #e0e0e0 !important;
        font-weight: 700;
        border: 0.9px solid #000 !important;
        text-align: center;
        color: #000 !important;
        padding: 3px 4px !important; /* REDUCED */
        white-space: nowrap;
        font-size: 8.5pt !important; /* REDUCED */
    }

    tbody td {
        border: 0.9px solid #000 !important;
        text-align: center;
        vertical-align: middle;
        padding: 2px 3px !important; /* REDUCED */
        background-color: transparent !important;
        color: #000 !important;
        font-size: 7pt !important; /* REDUCED */
    }

    tfoot td {
        font-weight: 700;
        border: 0.9px solid #000 !important;
        text-align: center;
        background-color: #eee !important;
        padding: 2px 3px !important; /* REDUCED */
        font-size: 7pt !important; /* REDUCED */
        font-style: italic;
    }

    /* Improved page break controls */
    h1, h2, h3, h4 {
        page-break-after: avoid;
    }

    /* Allow rows to break if table is long */
    tr {
        page-break-inside: auto; /* CHANGED from avoid */
        break-inside: auto;
    }

    /* Force table rows to break naturally in long tables */
    tbody tr {
        page-break-inside: auto;
    }

    .header-title,
    .meta-bar,
    thead th,
    tfoot td {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
    }

    .print-controls {
        display: none;
    }
}

    </style>
  </head>
  <body>
    <!-- Normal Mode Content (Hidden when printing) -->
    <div class="notprintable">
        <header id="myheader" class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
            <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Company name</a>
            <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <input class="form-control form-control-dark w-100" type="text" placeholder="Search" aria-label="Search">
            <div class="navbar-nav">
                <div class="nav-item text-nowrap">
                    <a class="nav-link px-3" href="#">Sign out</a>
                </div>
            </div>
        </header>

        <div class="container-fluid">
            <div class="row">
                <nav id="sidebarMenu" class="notprintable col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
                    <div class="position-sticky pt-3">
                        <ul class="nav flex-column">
                            <li class="nav-item">
                                <a class="nav-link" href="" data-bs-toggle="collapse" data-bs-target="#dashboardDropdown" aria-expanded="false" aria-controls="dashboardDropdown">
                                    <span data-feather="home"></span>
                                    Dashboard
                                </a>
                                <ul class="collapse nav flex-column sub-menu ms-5" id="dashboardDropdown">
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            Overview
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            Analytics
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#ordersDropdown" aria-expanded="false" aria-controls="ordersDropdown">
                                    <span data-feather="file"></span>
                                    Orders
                                </a>
                                <ul class="collapse nav flex-column sub-menu" id="ordersDropdown">
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            New Orders
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="createorder.html">
                                            create Order
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            All Orders
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            Completed Orders
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="shopping-cart"></span>
                                    Products
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="users"></span>
                                    Customers
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="bar-chart-2"></span>
                                    Reports
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="layers"></span>
                                    Integrations
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#" data-bs-toggle="collapse" data-bs-target="#settingsDropdown" aria-expanded="false" aria-controls="settingsDropdown">
                                    <span data-feather="settings"></span>
                                    Settings
                                </a>
                                <ul class="collapse nav flex-column sub-menu" id="settingsDropdown">
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            General Settings
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            User Management
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" href="#">
                                            Email Templates
                                        </a>
                                    </li>
                                </ul>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="help-circle"></span>
                                    Help
                                </a>
                            </li>
                        </ul>

                        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                            <span>Saved reports</span>
                            <a class="link-secondary" href="#" aria-label="Add a new report">
                                <span data-feather="plus-circle"></span>
                            </a>
                        </h6>
                        <ul class="nav flex-column mb-2">
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Current month
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Last quarter
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Social engagement
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="#">
                                    <span data-feather="file-text"></span>
                                    Year-end sale
                                </a>
                            </li>
                        </ul>
                    </div>
                </nav>

<main class="notprintable col-md-9 ms-sm-auto col-lg-10 px-md-4">
                    <div class="notprintable">
                        <div id="mytitles" class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <div class="row mb-2">
                                <div class="col">
                                    <h1 class="h5 mb-0 text-primary fw-bold">Invoice Entry for Accountants</h1>
                                    <p class="text-muted small mb-0">create a record of the purchase your organization made</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Work Content -->
                    <div class="container-fluid">
                        <!-- Combined Purchase Info Card -->
                        <div class="row mb-2">
                            <div class="col p-0">
                                <div class="card card-glass border-0">
                                    <div class="card-header invoice-header py-1">
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-receipt me-2"></i>
                                            <h2 class="h6 mb-0 fw-normal">Purchase Information</h2>
                                        </div>
                                    </div>
                                    <div class="card-body p-2">
                                        <div class="row g-2">
                                            <!-- Invoice Details Column -->
                                            <div class="col-md-4">
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Invoice No.</label>
                                                    <div class="input-group input-group-sm">
                                                        <input type="text" class="form-control form-control-sm" id="invoiceNo" placeholder="Enter invoice number">
                                                        <button class="btn btn-outline-secondary btn-xs" type="button" id="copyInvoiceBtn" title="Copy to clipboard">
                                                            <i class="bi bi-clipboard"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Current Date</label>
                                                    <input type="text" class="form-control form-control-sm" id="currentDate" readonly>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Invoice Date</label>
                                                    <input type="date" class="form-control form-control-sm" id="invoiceDate">
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Voucher Type Name</label>
                                                    <select class="form-select form-select-sm" id="voucherTypeName">
                                                        <option selected>Standard Invoice</option>
                                                        <option>Credit Note</option>
                                                        <option>Debit Note</option>
                                                        <option>Proforma Invoice</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Voucher Type Code</label>
                                                    <input type="text" class="form-control form-control-sm" id="voucherTypeCode" placeholder="Voucher code">
                                                </div>
                                            </div>
                                            
                                            <!-- Vendor & PO Column -->
                                            <div class="col-md-4">
                                                <div class="mb-2">
                                                    <label class="compact-form-label">PO Number</label>
                                                    <div class="input-group input-group-sm">
                                                        <input type="text" class="form-control form-control-sm" id="poNumber" placeholder="Scan or type PO...">
                                                        <button class="btn btn-outline-secondary btn-xs" type="button" id="scanPoBtn">
                                                            <i class="bi bi-upc-scan"></i>
                                                        </button>
                                                    </div>
                                                    <div class="po-alert alert alert-danger mt-1 py-1 small">
                                                        <i class="bi bi-exclamation-circle me-1"></i> 
                                                        PO not found in system
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">
                                                        Vendor Code 
                                                        <span class="ms-1" id="vendorInfo" data-bs-toggle="tooltip" data-bs-placement="top" title="Vendor details">
                                                            <i class="bi bi-info-circle text-primary"></i>
                                                        </span>
                                                    </label>
                                                    <div class="position-relative">
                                                        <input type="text" class="form-control form-control-sm" id="vendorCode" placeholder="Start typing vendor code...">
                                                        <div class="tooltip-panel" id="vendorTooltip">
                                                            <h6 class="mb-1 fw-bold">Vendor History</h6>
                                                            <div class="vendor-history-item small">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>INV-2023-03456</span>
                                                                    <span class="text-success">$1,245.67</span>
                                                                </div>
                                                                <div class="text-muted">2023-07-22 • Paid</div>
                                                            </div>
                                                            <div class="vendor-history-item small">
                                                                <div class="d-flex justify-content-between">
                                                                    <span>INV-2023-02876</span>
                                                                    <span class="text-success">$987.50</span>
                                                                </div>
                                                                <div class="text-muted">2023-06-15 • Paid</div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Vendor Name</label>
                                                    <input type="text" class="form-control form-control-sm" id="vendorName" >
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Payment Type</label>
                                                    <select class="form-select form-select-sm" id="paymentType">
                                                        <option selected>Cash</option>
                                                        <option>Credit Card</option>
                                                        <option>Bank Transfer</option>
                                                        <option>Check</option>
                                                    </select>
                                                </div>
                                            </div>
                                            
                                            <!-- Payment & Currency Column -->
                                            <div class="col-md-4">
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Payment Period (days)</label>
                                                    <input type="number" class="form-control form-control-sm" id="creditPeriod" value="30" min="0" max="90">
                                                    <div class="d-flex mt-1">
                                                        <div class="risk-bar risk-low me-1"></div>
                                                        <div class="risk-bar risk-medium me-1"></div>
                                                        <div class="risk-bar risk-high"></div>
                                                    </div>
                                                    <div class="d-flex justify-content-between small text-muted mt-1">
                                                        <span>0</span>
                                                        <span>30</span>
                                                        <span>60</span>
                                                        <span>90</span>
                                                    </div>
                                                    <div class="text-muted small text-center mt-1">
                                                        <span class="text-danger">Danger</span> | 
                                                        <span class="text-warning">Good</span> | 
                                                        <span class="text-success">Great</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Subtotal</label>
                                                    <input type="text" class="form-control form-control-sm" id="subtotal" placeholder="0.00" readonly>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Discount</label>
                                                    <div class="input-group input-group-sm">
                                                        <input type="text" class="form-control form-control-sm" id="discount" placeholder="0.00">
                                                        <span class="input-group-text">%</span>
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Tax Amount</label>
                                                    <input type="text" class="form-control form-control-sm" id="taxAmount" placeholder="0.00" readonly>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Total Payable</label>
                                                    <input type="text" class="form-control form-control-sm" id="totalPayable" placeholder="0.00" readonly>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Currency</label>
                                                    <div class="input-group input-group-sm">
                                                        <select class="form-select form-select-sm" id="currencySelect">
                                                            <option value="USD" selected>USD - US Dollar</option>
                                                            <option value="EUR">EUR - Euro</option>
                                                            <option value="GBP">GBP - British Pound</option>
                                                            <option value="JPY">JPY - Japanese Yen</option>
                                                            <option value="pkr">pkr  - pakistani rupes</option>
                                                        </select>
                                                        <span class="input-group-text bg-warning bg-opacity-10">
                                                            <i class="bi bi-currency-exchange text-warning"></i>
                                                        </span>
                                                    </div>
                                                    <div class="currency-alert alert alert-warning mt-1 py-1 small">
                                                        <i class="bi bi-exclamation-triangle me-1"></i> 
                                                        Currency doesn't match Purchase Order
                                                    </div>
                                                </div>
                                                
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Target Location</label>
                                                    <select class="form-select form-select-sm" id="targetLocation">
                                                        <option selected>Main Warehouse</option>
                                                        <option>Jeddah Warehouse</option>
                                                        <option>Riyadh Store</option>
                                                        <option>Dammam Distribution</option>
                                                    </select>
                                                </div>
                                                <div class="mb-2">
                                                    <label class="compact-form-label">Target Location code </label>
                                                    <input type="text" class="form-control form-control-sm" id="TargetLocationcode" >
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Sticky Action Bar -->
                        <div class="row sticky-bar">
                            <div class="col d-flex justify-content-end gap-1">
                             
                                <button class="btn btn-success btn-sm" id="exportExcelBtn" title="Export table to Excel">
    <i class="bi bi-file-earmark-excel me-1"></i> Export
</button>
                                <button class="btn btn-primary btn-sm px-3" id="saveBtn">
                                    <i class="bi bi-save me-1"></i> Save & Continue <span class="badge bg-dark badge-sm">Alt+S</span>
                                </button>
                                <button class="btn btn-info btn-sm px-2" id="printBtn">
                                    <i class="bi bi-printer me-1"></i> Print <span class="badge bg-dark badge-sm">Alt+P</span>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tabs Section -->
                        <div class="row mt-2">
                            <div class="col p-0">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="items-tab" data-bs-toggle="tab" data-bs-target="#items" type="button" role="tab">Items <span id="itemCount" class="badge bg-primary badge-sm">120</span></button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="attachments-tab" data-bs-toggle="tab" data-bs-target="#attachments" type="button" role="tab">Attachments <span id="attachmentCount" class="badge bg-primary badge-sm">0</span></button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="myTabContent">
                                    <!-- Items Tab -->
                                    <div class="tab-pane fade show active" id="items" role="tabpanel">
                                        <div class="card border-top-0">
                                            <div class="card-body p-0">
                                                <div class="table-responsive table-scroll">
                                                    <table class="table table-sm table-hover mb-0" id="itemsTable">
                                                        <thead class="table-light" style="background: linear-gradient(to right, #0d6efd, #0b5ed7);">
                                                            <tr>
                                                                <th width="4%" class="text-center">#</th>
                                                                <th width="4%" class="text-center">
                                                                    <input type="checkbox" id="selectAll" title="Select all rows">
                                                                </th>
                                                                <th width="20%">Item Code</th>
                                                                <th width="30%">Description</th>
                                                                <th width="10%">Quantity</th>
                                                                <th width="16%">Unit Price</th>
                                                                <th width="16%">Total</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <!-- Rows will be populated by JavaScript -->
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="table-controls d-flex justify-content-between p-1">
                                                    <div>
                                                        <button class="btn btn-sm btn-outline-danger me-1 btn-xs" id="removeRowBtn" disabled>
                                                            <i class="bi bi-dash-lg me-1"></i> Remove Selected
                                                        </button>
                                                        <button class="btn btn-sm btn-success btn-xs" id="addRowBtn">
                                                            <i class="bi bi-plus-lg me-1"></i> Add
                                                        </button>
                                                    </div>
                                                    <div class="text-muted small d-flex align-items-center">
                                                        <span id="selectedCount">0 selected</span>
                                                        <span class="mx-2">•</span>
                                                        <span id="rowCount">120 rows</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- MODIFIED Attachments Tab -->
                                    <div class="tab-pane fade" id="attachments" role="tabpanel">
                                        <div class="card border-top-0">
                                            <div class="card-body p-2">

                                                <!-- Upload Section -->
                                                <div class="card card-glass p-3 mb-3" id="uploadFieldsContainer">
                                                    <div class="d-flex align-items-center mb-3">
                                                        <i class="bi bi-paperclip text-primary me-2 fs-5"></i>
                                                        <h6 class="mb-0 fw-semibold text-primary">File Attachments (5 files)</h6>
                                                    </div>

                                                    <!-- Five identical file upload fields -->
                                                    <div class="upload-field-row border rounded p-2 mb-2 bg-light bg-opacity-50">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control form-control-sm custom-name" placeholder="Enter custom file name...">
                                                            </div>
                                                            <div class="col-md-2 position-relative">
                                                                <button type="button" class="btn btn-primary btn-sm w-100 upload-btn">
                                                                    <i class="bi bi-upload"></i> Upload
                                                                </button>
                                                                <input type="file" class="hidden-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx" hidden>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button type="button" class="btn btn-outline-info btn-sm w-100 view-btn" disabled>
                                                                    <i class="bi bi-eye"></i> View
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="upload-field-row border rounded p-2 mb-2 bg-light bg-opacity-50">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control form-control-sm custom-name" placeholder="Enter custom file name...">
                                                            </div>
                                                            <div class="col-md-2 position-relative">
                                                                <button type="button" class="btn btn-primary btn-sm w-100 upload-btn">
                                                                    <i class="bi bi-upload"></i> Upload
                                                                </button>
                                                                <input type="file" class="hidden-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx" hidden>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button type="button" class="btn btn-outline-info btn-sm w-100 view-btn" disabled>
                                                                    <i class="bi bi-eye"></i> View
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="upload-field-row border rounded p-2 mb-2 bg-light bg-opacity-50">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control form-control-sm custom-name" placeholder="Enter custom file name...">
                                                            </div>
                                                            <div class="col-md-2 position-relative">
                                                                <button type="button" class="btn btn-primary btn-sm w-100 upload-btn">
                                                                    <i class="bi bi-upload"></i> Upload
                                                                </button>
                                                                <input type="file" class="hidden-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx" hidden>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button type="button" class="btn btn-outline-info btn-sm w-100 view-btn" disabled>
                                                                    <i class="bi bi-eye"></i> View
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="upload-field-row border rounded p-2 mb-2 bg-light bg-opacity-50">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control form-control-sm custom-name" placeholder="Enter custom file name...">
                                                            </div>
                                                            <div class="col-md-2 position-relative">
                                                                <button type="button" class="btn btn-primary btn-sm w-100 upload-btn">
                                                                    <i class="bi bi-upload"></i> Upload
                                                                </button>
                                                                <input type="file" class="hidden-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx" hidden>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button type="button" class="btn btn-outline-info btn-sm w-100 view-btn" disabled>
                                                                    <i class="bi bi-eye"></i> View
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <div class="upload-field-row border rounded p-2 mb-2 bg-light bg-opacity-50">
                                                        <div class="row g-2 align-items-center">
                                                            <div class="col-md-8">
                                                                <input type="text" class="form-control form-control-sm custom-name" placeholder="Enter custom file name...">
                                                            </div>
                                                            <div class="col-md-2 position-relative">
                                                                <button type="button" class="btn btn-primary btn-sm w-100 upload-btn">
                                                                    <i class="bi bi-upload"></i> Upload
                                                                </button>
                                                                <input type="file" class="hidden-file" accept=".pdf,.jpg,.jpeg,.png,.doc,.docx,.xls,.xlsx" hidden>
                                                            </div>
                                                            <div class="col-md-2">
                                                                <button type="button" class="btn btn-outline-info btn-sm w-100 view-btn" disabled>
                                                                    <i class="bi bi-eye"></i> View
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </div>

                                                    <!-- No "Add another file" button as requested -->
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
    </div>

    <!-- PDF Modal -->
    <div class="modal fade" id="pdfModal" tabindex="-1">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="pdfModalLabel">PDF Viewer</h5>
                    <div class="ms-auto d-flex align-items-center">
                        <button class="btn btn-outline-secondary btn-sm me-2" id="zoomOut"><i class="bi bi-zoom-out"></i></button>
                        <span id="zoomLevel" class="me-2">100%</span>
                        <button class="btn btn-outline-secondary btn-sm me-2" id="zoomIn"><i class="bi bi-zoom-in"></i></button>
                        <button class="btn btn-outline-primary btn-sm" id="printPdf"><i class="bi bi-printer"></i> Print</button>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="pdf-canvas-container" id="pdfContainer">
                        <div class="text-center p-5 text-muted" id="loadingIndicator">
                            <div class="spinner-border text-primary mb-2"></div> Loading PDF...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden iframe for printing -->
    <iframe id="print-frame"></iframe>

    <!-- Print Section (Hidden in normal mode, shown only when printing) -->
    <div id="printSection">
        <div class="print-container">
            <div class="header-title">Entry Voucher</div>

            <div class="meta-bar">
                <div class="left">Printed by: Salman Khan</div>
                <div class="right">Printed on: 09/08/2025 16:07</div>
                <div class="full">Company: Care Storage Trading Co.</div>
            </div>

            <div class="card-invoice">
                <div class="invoice-meta">
                    <div class="row">
                        <div class="col-md-6 bigcol"><span class="label"> Iinvoice #:</span> <span class="value">900</span> </div>
                        
                        <div class="col-md-6 smlcol"><span class="label">Transaction Date:</span>  <span class="value">09/08/2025</span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-12 bigcol"><span class="label">Account Type:</span>  <span class="value"> Direct Purchase Voucher</span> </div>
                        <div class="col-md-4 smlcol"><span class="label">Party Type:</span><span class="value">Suppliers</span></div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 bigcol"><span class="label">Party:</span> <span class="value">Nutrition Supply Est. 0000763</span> </div>
                        
                        <div class="col-md-4 smlcol"><span class="label">Currency:</span> <span class="value">SAR</span> </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4"><span class="label">Target Location:</span> <span class="value"> 1311 Jeddah Warehouse</span></div>
                        
                        <div class="col-md-4"><span class="label">Notes:</span> <span class="value"> Nutrition Supply Est.</span></div>
                    </div>
                </div>
            </div>
<div class="table-container">
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Barcode</th>
                            <th>Code</th>
                            <th>Description</th>
                            <th>Qty</th>
                            <th>Free</th>
                            <th>Total</th>
                            <th>Unit</th>
                            <th>Base Qty</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>3401399277092</td>
                            <td>0139-54</td>
                            <td>Bioderma Face Wash 500ml Oily Skin (Blue)</td>
                            <td>312</td>
                            <td>0</td>
                            <td>312</td>
                            <td>Pcs</td>
                            <td>312 Pcs</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>3401399277108</td>
                            <td>0139-55</td>
                            <td>Bioderma Face Wash 500ml Dry Skin (Pink)</td>
                            <td>250</td>
                            <td>0</td>
                            <td>250</td>
                            <td>Pcs</td>
                            <td>250 Pcs</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>3401399277115</td>
                            <td>0139-56</td>
                            <td>Bioderma Face Wash 500ml Sensitive Skin (Green)</td>
                            <td>180</td>
                            <td>0</td>
                            <td>180</td>
                            <td>Pcs</td>
                            <td>180 Pcs</td>
                        </tr>
                    </tbody>
                    <tfoot>
                        <tr>
                            <td colspan="4" class="text-end">Subtotal</td>
                            <td>742.00</td>
                            <td>0.00</td>
                            <td>742.00</td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end">Discount</td>
                            <td colspan="2">5.00%</td>
                            <td>37.10</td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end">Total After Discount</td>
                            <td colspan="2"></td>
                            <td>704.90</td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end">VAT (15%)</td>
                            <td colspan="2"></td>
                            <td>105.74</td>
                            <td colspan="2"></td>
                        </tr>
                        <tr>
                            <td colspan="4" class="text-end">Grand Total</td>
                            <td colspan="2"></td>
                            <td>810.64</td>
                            <td colspan="2"></td>
                        </tr>
                    </tfoot>
                </table>
            </div>
        </div>
    </div>

    <script src="js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons@4.28.0/dist/feather.min.js" integrity="sha384-uO3SXW5IuS1ZpFPKugNNWqTZRRglnUJK6UAZ/gxOX80nxEkN9NcGZTftn6RzhGWE" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js" integrity="sha384-zNy6FEbO50N+Cg5wap8IKA4M/ZnLJgzc6w2NqACZaK0u0FXfOWRRJOnQtpZun8ha" crossorigin="anonymous"></script>
    <script src="dashboard.js"></script>
    
    <script>
        // PDF.js configuration
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js";

        // File attachment variables
        const fileUpload = document.getElementById("fileUpload");
        const uploadArea = document.getElementById("uploadArea");
        const fileList = document.getElementById("fileList");
        const attachmentCount = document.getElementById("attachmentCount");
        const pdfModal = new bootstrap.Modal(document.getElementById("pdfModal"));
        const pdfContainer = document.getElementById("pdfContainer");
        const loadingIndicator = document.getElementById("loadingIndicator");
        const zoomIn = document.getElementById("zoomIn");
        const zoomOut = document.getElementById("zoomOut");
        const zoomLevel = document.getElementById("zoomLevel");
        const printPdf = document.getElementById("printPdf");
        const printFrame = document.getElementById("print-frame");

        let attachments = [];
        let pdfDoc = null;
        let scale = 1.0;
        let currentPdfUrl = null;

        // MODIFIED: Initialize all 5 file upload fields
        document.querySelectorAll(".upload-field-row").forEach(row => {
            attachUploadHandlers(row);
        });

        function attachUploadHandlers(row) {
            const uploadBtn = row.querySelector(".upload-btn");
            const viewBtn = row.querySelector(".view-btn");
            const fileInput = row.querySelector(".hidden-file");
            const customNameInput = row.querySelector(".custom-name");

            uploadBtn.addEventListener("click", () => {
                const customName = customNameInput.value.trim();
                if (!customName) {
                    alert("Please enter a custom file name before uploading.");
                    return;
                }
                // Trigger hidden file chooser
                fileInput.click();

                fileInput.onchange = () => {
                    if (fileInput.files.length === 0) return;
                    const file = fileInput.files[0];

                    // Rename file before upload
                    const renamedFile = new File([file], customName + "." + file.name.split('.').pop(), { type: file.type });

                    // Use your existing upload logic
                    handleFiles([renamedFile]);

                    // Enable View button
                    viewBtn.disabled = false;
                    viewBtn.dataset.url = URL.createObjectURL(file);
                };
            });

            viewBtn.addEventListener("click", () => {
                if (viewBtn.dataset.url) {
                    openPdf(viewBtn.dataset.url); // existing PDF viewer
                }
            });
        }

        // Existing file upload functionality (for drag & drop)
        function handleFiles(files) {
            for(const f of files){
                const type = f.name.split(".").pop().toLowerCase() === "pdf" ? "pdf":"other";
                const url = URL.createObjectURL(f);
                attachments.push({id:Date.now(), name:f.name, type, url, file: f});
            }
            updateAttachmentCount();
        }

        function updateAttachmentCount(){
            attachmentCount.textContent = attachments.length;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeFile(id) {
            attachments = attachments.filter(a => a.id != id);
            updateAttachmentCount();
        }

        // PDF Viewer functionality
        async function openPdf(url){
            currentPdfUrl = url;
            pdfModal.show();
            pdfContainer.innerHTML="";
            loadingIndicator.style.display="block";
            pdfContainer.appendChild(loadingIndicator);
            pdfDoc = await pdfjsLib.getDocument(url).promise;
            loadingIndicator.style.display="none";
            renderAllPages();
        }

        async function renderAllPages(){
            pdfContainer.innerHTML="";
            for(let i=1;i<=pdfDoc.numPages;i++){
                const page = await pdfDoc.getPage(i);
                const viewport = page.getViewport({scale});
                const canvas = document.createElement("canvas");
                canvas.classList.add("pdf-page");
                canvas.height = viewport.height;
                canvas.width = viewport.width;
                const ctx = canvas.getContext("2d");
                await page.render({canvasContext: ctx, viewport}).promise;
                pdfContainer.appendChild(canvas);
            }
        }

        zoomIn.addEventListener("click", ()=>{scale+=0.1; renderAllPages(); zoomLevel.textContent=Math.round(scale*100)+"%";});
        zoomOut.addEventListener("click", ()=>{scale=Math.max(0.5,scale-0.1); renderAllPages(); zoomLevel.textContent=Math.round(scale*100)+"%";});

        // PDF Printing functionality
        async function printPdfAllPages() {
            if (!currentPdfUrl) {
                alert("No PDF loaded to print");
                return;
            }
            
            // Show loading indicator
            const loadingToast = document.createElement('div');
            loadingToast.className = 'loading-toast';
            loadingToast.innerHTML = '<div class="spinner-border spinner-border-sm me-2"></div>Preparing PDF for printing...';
            document.body.appendChild(loadingToast);
            
            try {
                // Create a new PDF document instance for printing
                const printPdfDoc = await pdfjsLib.getDocument(currentPdfUrl).promise;
                
                // Create HTML content for printing
                let printHTML = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>PDF Print</title>
                        <style>
                            body { margin: 0; padding: 20px; font-family: Arial, sans-serif; }
                            .pdf-page { 
                                width: 100%; 
                                height: auto; 
                                margin-bottom: 20px; 
                                page-break-after: always;
                                box-shadow: 0 0 5px rgba(0,0,0,0.1);
                            }
                            .pdf-page:last-child { page-break-after: auto; }
                            .page-header { 
                                text-align: center; 
                                margin-bottom: 20px; 
                                padding-bottom: 10px; 
                                border-bottom: 1px solid #ddd;
                            }
                            @media print {
                                body { padding: 0; }
                                .pdf-page { margin-bottom: 0; box-shadow: none; }
                                .page-header { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="page-header">
                            <h2>PDF Document</h2>
                            <p>Printed on ${new Date().toLocaleDateString()}</p>
                        </div>
                `;
                
                // Render all pages as images
                for (let i = 1; i <= printPdfDoc.numPages; i++) {
                    const page = await printPdfDoc.getPage(i);
                    const viewport = page.getViewport({ scale: 1.5 });
                    
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    
                    await page.render({
                        canvasContext: ctx,
                        viewport: viewport
                    }).promise;
                    
                    const imgData = canvas.toDataURL('image/png');
                    printHTML += `<img class="pdf-page" src="${imgData}" alt="Page ${i}" />`;
                }
                
                printHTML += '<\/body><\/html>';
                
                // Write HTML to iframe
                const iframeDoc = printFrame.contentWindow.document;
                iframeDoc.open();
                iframeDoc.write(printHTML);
                iframeDoc.close();
                
                // Wait for images to load in iframe
                await new Promise(resolve => {
                    const iframeImgs = iframeDoc.querySelectorAll('img');
                    let loaded = 0;
                    
                    if (iframeImgs.length === 0) {
                        resolve();
                        return;
                    }
                    
                    iframeImgs.forEach(img => {
                        if (img.complete) {
                            loaded++;
                            if (loaded === iframeImgs.length) resolve();
                        } else {
                            img.onload = () => {
                                loaded++;
                                if (loaded === iframeImgs.length) resolve();
                            };
                        }
                    });
                });
                
                // Remove loading indicator
                document.body.removeChild(loadingToast);
                
                // Print the iframe content
                printFrame.contentWindow.focus();
                printFrame.contentWindow.print();
                
            } catch (error) {
                console.error('Error printing PDF:', error);
                document.body.removeChild(loadingToast);
                alert('Error printing PDF: ' + error.message);
            }
        }

        printPdf.addEventListener("click", printPdfAllPages);

        // NEW: Checkbox selection functionality
        let selectedRows = new Set();

        // Select All functionality
        document.getElementById('selectAll').addEventListener('change', function(e) {
            const checkboxes = document.querySelectorAll('.row-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = e.target.checked;
                const row = checkbox.closest('tr');
                if (e.target.checked) {
                    selectedRows.add(checkbox.value);
                    row.classList.add('row-selected');
                } else {
                    selectedRows.delete(checkbox.value);
                    row.classList.remove('row-selected');
                }
            });
            updateSelectedCount();
            updateRemoveButton();
        });

        // Individual checkbox selection
        function handleRowSelection(checkbox) {
            const row = checkbox.closest('tr');
            if (checkbox.checked) {
                selectedRows.add(checkbox.value);
                row.classList.add('row-selected');
            } else {
                selectedRows.delete(checkbox.value);
                row.classList.remove('row-selected');
                // Uncheck select all if any checkbox is unchecked
                document.getElementById('selectAll').checked = false;
            }
            updateSelectedCount();
            updateRemoveButton();
        }

        function updateSelectedCount() {
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = `${selectedRows.size} selected`;
        }

        function updateRemoveButton() {
            const removeBtn = document.getElementById('removeRowBtn');
            removeBtn.disabled = selectedRows.size === 0;
        }

        // Existing application code
        // Initialize tooltips
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl));
        
        // Set current date
        const currentDate = new Date();
        const formattedDate = currentDate.toLocaleDateString();
        document.getElementById('currentDate').value = formattedDate;
        
        // Generate table rows with empty data (UPDATED with checkboxes)
        function generateEmptyTableRows(count) {
            const tableBody = document.querySelector('#itemsTable tbody');
            tableBody.innerHTML = '';
            
            for (let i = 1; i <= count; i++) {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="text-center">${i}</td>
                    <td class="text-center">
                        <input class="form-check-input row-checkbox" type="checkbox" value="${i}">
                    </td>
                    <td class="editable-cell"><input type="text" value=""></td>
                    <td class="editable-cell"><input type="text" value=""></td>
                    <td class="editable-cell"><input type="number" value=""></td>
                    <td class="editable-cell"><input type="number" value=""></td>
                    <td class="editable-cell"><input type="number" value="" readonly></td>
                `;
                tableBody.appendChild(row);
                
                // Add event listener to checkbox
                const checkbox = row.querySelector('.row-checkbox');
                checkbox.addEventListener('change', () => handleRowSelection(checkbox));
            }
            document.getElementById('itemCount').textContent = count;
            document.getElementById('rowCount').textContent = `${count} rows`;
        }
        
        // Vendor history tooltip interaction
        const vendorInfo = document.getElementById('vendorInfo');
        const vendorTooltip = document.getElementById('vendorTooltip');
        
        vendorInfo.addEventListener('mouseenter', () => {
            vendorTooltip.style.display = 'block';
        });
        
        vendorInfo.addEventListener('mouseleave', () => {
            vendorTooltip.style.display = 'none';
        });
        
        // Update risk bar
        const creditPeriod = document.getElementById('creditPeriod');
        const riskBars = document.querySelectorAll('.risk-bar');
        
        function updateRiskBar() {
            const value = parseInt(creditPeriod.value) || 0;

            // Reset all bars
            riskBars.forEach(bar => {
                bar.classList.remove('risk-low', 'risk-medium', 'risk-high');
            });

            if (value < 30) {
                // High Risk - Danger (Red)
                riskBars[2].classList.add('risk-high');
            } else if (value <= 45) {
                // Medium Risk - Good (Yellow)
                riskBars[1].classList.add('risk-medium');
            } else {
                // Low Risk - Great (Green)
                riskBars[0].classList.add('risk-low');
            }
        }

        // Copy invoice number
        document.getElementById('copyInvoiceBtn').addEventListener('click', () => {
            const invoiceNo = document.getElementById('invoiceNo');
            invoiceNo.select();
            document.execCommand('copy');
            
            // Show visual feedback
            const copyBtn = document.getElementById('copyInvoiceBtn');
            const originalHTML = copyBtn.innerHTML;
            copyBtn.innerHTML = '<i class="bi bi-check"></i>';
            copyBtn.classList.add('btn-success');
            
            setTimeout(() => {
                copyBtn.innerHTML = originalHTML;
                copyBtn.classList.remove('btn-success');
            }, 1500);
        });
        
        // Currency mismatch alert
        document.getElementById('currencySelect').addEventListener('change', (e) => {
            const alert = document.querySelector('.currency-alert');
            if (e.target.value !== 'pkr') {
                alert.style.display = 'block';
            } else {
                alert.style.display = 'none';
            }
        });
        
        // PO number alert
        document.getElementById('poNumber').addEventListener('blur', (e) => {
            const alert = document.querySelector('.po-alert');
            if (e.target.value && !e.target.value.startsWith('PO-')) {
                alert.style.display = 'block';
            } else {
                alert.style.display = 'none';
            }
        });
        
        // Add new row (UPDATED with checkbox)
        // Add new row (UPDATED to insert after selected row)
document.getElementById('addRowBtn').addEventListener('click', () => {
    const tableBody = document.querySelector('#itemsTable tbody');
    const rows = tableBody.querySelectorAll('tr');
    
    // Find the last selected row (highest index)
    let insertAfterIndex = -1;
    if (selectedRows.size > 0) {
        const selectedIndices = Array.from(selectedRows).map(Number);
        insertAfterIndex = Math.max(...selectedIndices) - 1; // Convert to 0-based index
    }
    
    const newRow = document.createElement('tr');
    const newIndex = rows.length + 1;
    newRow.innerHTML = `
        <td class="text-center">${newIndex}</td>
        <td class="text-center">
            <input class="form-check-input row-checkbox" type="checkbox" value="${newIndex}">
        </td>
        <td class="editable-cell"><input type="text" value=""></td>
        <td class="editable-cell"><input type="text" value=""></td>
        <td class="editable-cell"><input type="number" value=""></td>
        <td class="editable-cell"><input type="number" value="0.00"></td>
        <td class="editable-cell"><input type="number" value="0.00" readonly></td>
    `;
    
    if (insertAfterIndex >= 0 && insertAfterIndex < rows.length - 1) {
        // Insert after the last selected row
        tableBody.insertBefore(newRow, rows[insertAfterIndex].nextSibling);
    } else {
        // If no selection or last row is selected, append to end
        tableBody.appendChild(newRow);
    }
    
    // Add event listener to new checkbox
    const checkbox = newRow.querySelector('.row-checkbox');
    checkbox.addEventListener('change', () => handleRowSelection(checkbox));
    
    // Update serial numbers
    updateSerialNumbers();
});
        // Remove selected rows (UPDATED for multiple rows)
        document.getElementById('removeRowBtn').addEventListener('click', () => {
            if (selectedRows.size === 0) return;
            
            // Convert Set to Array and sort in descending order to avoid index issues
            const rowsToRemove = Array.from(selectedRows).sort((a, b) => b - a);
            
            rowsToRemove.forEach(rowIndex => {
                const row = document.querySelector(`.row-checkbox[value="${rowIndex}"]`).closest('tr');
                row.remove();
                selectedRows.delete(rowIndex);
            });
            
            updateSerialNumbers();
            updateSelectedCount();
            updateRemoveButton();
        });
        
        // Update serial numbers in table
        function updateSerialNumbers() {
            const rows = document.querySelectorAll('#itemsTable tbody tr');
            const rowCount = rows.length;
            
            rows.forEach((row, index) => {
                const newIndex = index + 1;
                row.cells[0].textContent = newIndex;
                const checkbox = row.querySelector('.row-checkbox');
                checkbox.value = newIndex;
                
                // Update selection if this row was selected
                if (selectedRows.has(parseInt(checkbox.getAttribute('data-old-value') || '0'))) {
                    selectedRows.delete(parseInt(checkbox.getAttribute('data-old-value')));
                    selectedRows.add(newIndex);
                    checkbox.checked = true;
                }
                checkbox.setAttribute('data-old-value', newIndex);
            });
            
            document.getElementById('itemCount').textContent = rowCount; 
            document.getElementById('rowCount').textContent = `${rowCount} rows`;
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.altKey && e.key === 's') {
                e.preventDefault();
                document.getElementById('saveBtn').click();
            }
            
            if (e.altKey && e.key === 'p') {
                e.preventDefault();
                window.print();
            }
            
          
        });
        
        // Print functionality
        document.getElementById('printBtn').addEventListener('click', () => {
            window.print();
        });
        
        // Initialize the table with 120 empty rows
        generateEmptyTableRows(120);
        
        // Trigger initial risk bar update
        updateRiskBar();
        
        // Auto-update risk bar when credit period changes
        creditPeriod.addEventListener('input', updateRiskBar);
        
        // Simulate vendor name autofill
        document.getElementById('vendorCode').addEventListener('input', function(e) {
            if (e.target.value.length > 2) {
                document.getElementById('vendorName').value = 'Global Industrial Supplies Ltd.';
            } else {
                document.getElementById('vendorName').value = '';
            }
        });

        // Table navigation with arrow keys
        document.querySelector('#itemsTable').addEventListener('keydown', function (e) {
            const key = e.key;
            const input = e.target;
            if (input.tagName.toLowerCase() !== 'input') return;

            const cell = input.closest('td');
            const row = cell.closest('tr');
            const cellIndex = Array.from(row.children).indexOf(cell);
            const rowIndex = Array.from(row.parentElement.children).indexOf(row);

            let targetInput;

            if (key === 'ArrowRight') {
                const nextCell = row.children[cellIndex + 1];
                if (nextCell) targetInput = nextCell.querySelector('input');
            } else if (key === 'ArrowLeft') {
                const prevCell = row.children[cellIndex - 1];
                if (prevCell) targetInput = prevCell.querySelector('input');
            } else if (key === 'ArrowDown') {
                const nextRow = row.parentElement.children[rowIndex + 1];
                if (nextRow) {
                    const nextCell = nextRow.children[cellIndex];
                    if (nextCell) targetInput = nextCell.querySelector('input');
                }
            } else if (key === 'ArrowUp') {
                const prevRow = row.parentElement.children[rowIndex - 1];
                if (prevRow) {
                    const prevCell = prevRow.children[cellIndex];
                    if (prevCell) targetInput = prevCell.querySelector('input');
                }
            }

            if (targetInput) {
                e.preventDefault();
                targetInput.focus();
                targetInput.select();
            }
        });

        // Auto-print functionality
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('autoprint') === '1') {
            setTimeout(() => {
                window.print();
            }, 1000);
        }
    </script>
  </body>
</html>
